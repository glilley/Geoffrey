/*!
 * CSS Modal
 * http://drublic.github.com/css-modal
 *
 * @author Hans Christian Reinl - @drublic
 * @version 1.1.0alpha
 */(function(e){"use strict";var t={activeElement:undefined,lastActive:undefined,stackedElements:[],tabbableElements:"a[href], area[href], input:not([disabled]),select:not([disabled]), textarea:not([disabled]),button:not([disabled]), iframe, object, embed, *[tabindex],*[contenteditable]",on:function(e,t,n){if(typeof e!="string")throw new Error("Type error: `error` has to be a string");if(typeof n!="function")throw new Error("Type error: `callback` has to be a function");t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)},trigger:function(e,t){var n;if(!window.CustomEvent)return;n=new CustomEvent(e,{detail:{modal:t}});document.dispatchEvent(n)},addClass:function(e,t){e&&!e.className.match(t)&&(e.className+=" "+t)},removeClass:function(e,t){e.className=e.className.replace(t,"").replace("  "," ")},setFocus:function(){if(t.activeElement){t.lastActive=document.activeElement;t.activeElement.focus();t.keepFocus(t.activeElement)}},removeFocus:function(){t.lastActive&&t.lastActive.focus()},keepFocus:function(e){var n=e.querySelectorAll(t.tabbableElements),r=n[0],i=n[n.length-1],s=function(e){var t=e.which||e.keyCode;if(t!==9)return;e.preventDefault=e.preventDefault||function(){e.returnValue=!1};if(e.target===i&&!e.shiftKey){e.preventDefault();r.focus()}else if(e.target===r&&e.shiftKey){e.preventDefault();i.focus()}};t.on("keydown",e,s)},setActive:function(e){t.addClass(e,"is-active");t.activeElement=e;t.setFocus(e.id);t.trigger("cssmodal:show",t.activeElement)},unsetActive:function(e){if(t.activeElement){t.removeClass(t.activeElement,"is-active");t.trigger("cssmodal:hide",t.activeElement);t.removeFocus();e&&t.stackModal(t.activeElement);!e&&t.stackedElements.length>0&&t.unstackModal();t.activeElement=null}},stackModal:function(e){t.addClass(e,"is-stacked");t.stackedElements.push(t.activeElement)},unstackModal:function(){var e=t.stackedElements.length,n=t.stackedElements[e-1];t.removeClass(n,"is-stacked");window.location.hash=n.id;t.stackedElements.splice(e-1,1)},mainHandler:function(){var e=window.location.hash.replace("#",""),n=document.getElementById(e),r;if(n){r=n.children[0];if(r&&r.className.match(/modal-inner/)){t.addClass(document.documentElement,"has-overlay");t.unsetActive(!0);t.setActive(n)}}else{t.removeClass(document.documentElement,"has-overlay");t.unsetActive()}}};t.on("keyup",document,function(e){var n=window.location.hash.replace("#","");if(n===""||n==="!")return;if(e.keyCode===27){window.location.hash="!";if(t.lastActive)return!1;t.removeFocus()}},!1);t.on("hashchange",window,t.mainHandler);t.on("load",window,t.mainHandler);typeof module=="object"&&module&&typeof module.exports=="object"?module.exports=t:typeof define=="function"&&define.amd?define([],function(){return t}):typeof e=="object"&&typeof e.document=="object"&&(e.CSSModal=t)})(window);